<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atlas - Tu mundo bajo control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #1a202c; /* bg-gray-900 */
            color: #e2e8f0; /* text-gray-200 */
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        }
        .modal-bg {
            background-color: rgba(0, 0, 0, 0.7);
        }
        /* Estilos específicos para el chat y elementos del modal */
        #chat-box {
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding: 1rem;
            background-color: #1a202c; /* bg-slate-900 */
            border-top: 1px solid #2d3748; /* border-slate-800 */
        }
        .chat-message {
            margin-bottom: 0.75rem;
        }
        .chat-message.user-message {
            align-self: flex-end;
            background-color: #4c51bf; /* bg-indigo-700 */
            color: white;
            padding: 0.75rem;
            border-radius: 0.75rem;
            max-width: 75%;
        }
        .chat-message.system-message {
            align-self: flex-start;
            background-color: #2d3748; /* bg-slate-800 */
            color: #cbd5e0; /* text-slate-200 */
            padding: 0.75rem;
            border-radius: 0.75rem;
            max-width: 75%;
        }
        /* Ocultar scrollbar pero permitir scroll */
        .overflow-auto::-webkit-scrollbar {
            display: none;
        }
        .overflow-auto {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        /* Estilos del Toast */
        #toast {
            position: fixed;
            bottom: 1.5rem; /* 24px */
            left: 50%;
            transform: translateX(-50%);
            background-color: #2d3748; /* bg-slate-800 */
            color: #e2e8f0; /* text-gray-200 */
            padding: 0.75rem 1.5rem; /* py-3 px-6 */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none; /* Allows clicks to pass through when hidden */
        }
        
        /* Estilos del indicador de notificaciones */
        #notifications-indicator {
            transition: all 0.2s ease-in-out;
            border-radius: 0.5rem;
            padding: 0.5rem;
        }
        
        #notifications-indicator:hover {
            background-color: rgba(251, 191, 36, 0.1);
            transform: scale(1.05);
        }
        
        #notifications-indicator:active {
            transform: scale(0.95);
        }
        
        /* Animación shake para notificaciones */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
            20%, 40%, 60%, 80% { transform: translateX(2px); }
        }
        #toast.hidden {
            display: none;
        }
        #toast.opacity-0 {
            opacity: 0;
        }

        /* Clases personalizadas para anchos específicos */
        .w-7\/10 {
            width: 70%;
        }
        .w-3\/10 {
            width: 30%;
        }
        
        /* Estilos para botón deshabilitado */
        .btn-disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        .btn-disabled:hover {
            background-color: inherit !important;
        }
        
        /* 🔒 Estilos para checkbox de privacidad deshabilitado */
        #edit-private:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        #edit-private:disabled + label {
            opacity: 0.6;
            cursor: not-allowed;
            color: #94a3b8; /* text-slate-400 */
        }
        
        /* Estilos personalizados para scrollbars */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1e293b; /* bg-slate-800 */
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #475569; /* bg-slate-600 */
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* bg-slate-500 */
        }
        
        /* Estilos para el menú hamburguesa */
        .hamburger-menu {
            position: relative;
        }
        
        .hamburger-button {
            background: none;
            border: none;
            color: #e2e8f0;
            padding: 8px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .hamburger-button:hover {
            background-color: #475569;
        }
        
        .hamburger-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            min-width: 200px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
        }
        
        .hamburger-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        /* Debug styles para el menú hamburguesa de gestión de usuarios */
        #hamburger-dropdown-user-management {
            z-index: 1001; /* Mayor z-index para asegurar visibilidad */
        }
        
        #hamburger-dropdown-user-management.show {
            opacity: 1 !important;
            visibility: visible !important;
            transform: translateY(0) !important;
        }
        
        .hamburger-item {
            display: block;
            width: 100%;
            padding: 12px 16px;
            text-align: left;
            background: none;
            border: none;
            color: #e2e8f0;
            cursor: pointer;
            transition: background-color 0.2s;
            border-bottom: 1px solid #334155;
        }
        
        .hamburger-item:last-child {
            border-bottom: none;
        }
        
        .hamburger-item:hover {
            background-color: #334155;
        }
        
        .hamburger-item.help-item {
            color: #60a5fa;
            font-weight: 500;
        }
        
        .hamburger-item.help-item:hover {
            background-color: #1e40af;
            color: white;
        }
        
        /* Estilos para el modal de ayuda */
        .help-modal {
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .help-section {
            margin-bottom: 24px;
            padding: 16px;
            background: #334155;
            border-radius: 8px;
            border-left: 4px solid #60a5fa;
        }
        
        .help-section h3 {
            color: #60a5fa;
            margin-bottom: 12px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .help-section p {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .help-section ul {
            margin-left: 20px;
            margin-bottom: 8px;
        }
        
        .help-section li {
            margin-bottom: 4px;
        }
        
        .help-feature {
            background: #475569;
            padding: 8px 12px;
            border-radius: 6px;
            margin: 8px 0;
            border-left: 3px solid #60a5fa;
        }
        
        .help-feature strong {
            color: #60a5fa;
        }
        
        /* Estilos para elementos con scrollbar personalizado */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b; /* bg-slate-800 */
            border-radius: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569; /* bg-slate-600 */
            border-radius: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* bg-slate-500 */
        }
        
        /* Estilos para el modal de ayuda */
        .help-modal::-webkit-scrollbar {
            width: 8px;
        }
        
        .help-modal::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 4px;
        }
        
        .help-modal::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        
        .help-modal::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Eliminar espaciado superior */
#screen-login, #screen-main, #screen-user-management {
    margin-top: 0;
    padding-top: 0;
}

/* Header fijo para la pantalla principal */
#screen-main header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 999;
    margin-top: 0;
}

/* Ajustar el main para que no se superponga con el header fijo */
#screen-main main {
    margin-top: 72px; /* Altura del header */
}

/* Header fijo para la pantalla de gestión de usuarios */
#screen-user-management header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 999;
    margin-top: 0;
}

/* Ajustar el main de gestión de usuarios para que no se superponga con el header fijo */
#screen-user-management main {
    margin-top: 72px; /* Altura del header */
}
        
    </style>
</head>
<body class="bg-slate-900 text-slate-200 min-h-screen flex flex-col">

   <div id="toast" class="hidden"></div>
   <div id="screen-login" class="flex-1 flex flex-col items-center justify-center p-8">
        <!-- Icono y eslogan de la aplicación -->
        <div class="text-center mb-8">
            <img src="icono.jpg" alt="Atlas" class="w-24 h-24 mx-auto mb-4 rounded-full shadow-lg">
            <h1 class="text-5xl font-bold mb-2 text-indigo-400">Atlas</h1>
        </div>
        
        <div class="bg-slate-800 p-8 rounded-xl shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-semibold mb-6 text-center">Iniciar Sesión</h2>
            <div class="flex flex-col gap-4">
                <div>
                    <label for="login-username" class="block text-sm mb-1">Usuario:</label>
                    <input type="text" id="login-username" class="w-full px-3 py-2 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Nombre de usuario" />
                </div>
                <div>
                    <label for="login-password" class="block text-sm mb-1">Contraseña:</label>
                    <input type="password" id="login-password" class="w-full px-3 py-2 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Contraseña" />
                </div>
                <button id="btn-login" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 mt-2">
                    Iniciar Sesión
                </button>
                <p id="login-error-message" class="text-rose-400 text-center text-sm mt-2 hidden">
                    </p>
                <p id="btn-show-new-user-modal" class="text-indigo-400 text-center text-sm mt-4 cursor-pointer hover:text-indigo-300 transition-colors">
                    Nuevo usuario
                </p>
            </div>
        </div>
    </div>

    <div id="screen-main" class="hidden flex-1 flex flex-col">
        <header class="bg-slate-800 shadow-md p-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold">Tareas</h1>
            <div class="flex items-center gap-4">
                <span class="text-slate-300">Usuario: <span id="current-user" class="font-semibold text-indigo-400 cursor-pointer hover:text-indigo-300 transition-colors"></span></span>
                <div id="notifications-indicator" class="flex items-center gap-1 text-amber-400 hidden">
                    <div class="flex items-center justify-center w-4 h-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M6 8a6 6 0 0 1 12 0c0 7 3 8 3 8H3s3-1 3-8"/>
                            <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
                        </svg>
                    </div>
                    <span id="total-notifications-count" class="text-sm font-semibold">0</span>
                </div>
                
                <!-- Menú hamburguesa -->
                <div class="hamburger-menu">
                    <button id="hamburger-button" class="hamburger-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                    <div id="hamburger-dropdown" class="hamburger-dropdown">
                        <button id="btn-main-tasks" class="hamburger-item">
                            Tareas
                        </button>
                        <button id="btn-department-management" class="hamburger-item hidden">
                            Departamentos
                        </button>
                        <button id="btn-user-management" class="hamburger-item hidden">
                            Usuarios
                        </button>
                        <button id="btn-change-password" class="hamburger-item">
                            Cambiar Contraseña
                        </button>
                        <button id="btn-delete-own-account" class="hamburger-item" style="color: #fca5a5;">
                            Eliminar Mi Cuenta
                        </button>
                        <button id="btn-help" class="hamburger-item help-item">
                            Ayuda
                        </button>
                        <button id="btn-logout" class="hamburger-item">
                            Cerrar Sesión
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-1 p-4 flex flex-col">
            <div class="flex gap-4 mb-4">
                <div id="new-task-section" class="bg-slate-800 p-4 rounded-xl shadow-lg w-7/10">
                    <h2 class="text-lg font-semibold mb-3">Crear Nueva Tarea</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="new-title" class="block text-xs mb-1">Título</label>
                            <input type="text" id="new-title" class="w-full px-3 py-1.5 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Título de la tarea" />
                        </div>
                        <div>
                            <label for="new-priority" class="block text-xs mb-1">Prioridad</label>
                            <select id="new-priority" class="w-full px-3 py-1.5 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option>Urgente</option>
                                <option>Alta</option>
                                <option selected>Media</option>
                                <option>Baja</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label for="new-desc" class="block text-xs mb-1">Descripción (Opcional)</label>
                            <textarea id="new-desc" rows="4" class="w-full px-3 py-1.5 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Detalles de la tarea"></textarea>
                        </div>
                        <div>
                            <label for="new-assigned-to" class="block text-xs mb-1">Asignado a</label>
                            <select id="new-assigned-to" class="w-full px-3 py-1.5 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="Agustín">Agustín</option>
                                <option value="Héctor">Héctor</option>
                            </select>
                        </div>
                        <div class="flex items-center mt-auto md:col-span-1"> <div class="flex items-center">
                                <input type="checkbox" id="new-private" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded mr-2" />
                                <label for="new-private" class="text-xs">Tarea privada (solo visible para el creador)</label>
                            </div>
                            <button id="btn-create" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-1.5 px-4 rounded-lg transition duration-200 text-sm ml-auto">
                                Crear Tarea
                            </button>
                        </div>
                    </div>
                </div>

                <div id="filter-task-section" class="bg-slate-800 p-4 rounded-xl shadow-lg w-3/10 flex flex-col justify-between">
                    <div>
                        <h2 class="text-lg font-semibold mb-3">Filtrar Tareas</h2>
                        <div class="grid grid-cols-1 gap-3">
                            <div>
                                <label for="filter-text" class="block text-xs mb-1">Buscar por texto</label>
                                <input type="text" id="filter-text" class="w-full px-3 py-1.5 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Título o descripción" />
                            </div>
                            <div>
                                <label for="filter-state" class="block text-xs mb-1">Estado</label>
                                <select id="filter-state" class="w-full px-3 py-1.5 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="OPEN_TASKS" selected>Tareas abiertas</option>
                                    <option value="">Todos</option>
                                    <option>Sin iniciar</option>
                                    <option>En progreso</option>
                                    <option>En espera</option>
                                    <option>Finalizada</option>
                                </select>
                            </div>
                            <div>
                                <label for="filter-priority" class="block text-xs mb-1">Prioridad</label>
                                <select id="filter-priority" class="w-full px-3 py-1.5 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Todas</option>
                                    <option>Urgente</option>
                                    <option>Alta</option>
                                    <option>Media</option>
                                    <option>Baja</option>
                                </select>
                            </div>
                            <div>
                                <label for="filter-assigned-to" class="block text-xs mb-1">Asignado a</label>
                                <select id="filter-assigned-to" class="w-full px-3 py-1.5 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Todos</option>
                                    <option value="Agustín">Agustín</option>
                                    <option value="Héctor">Héctor</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col gap-2 mt-3">
                        <button id="btn-reset-filters" class="w-full bg-slate-600 hover:bg-slate-700 text-white font-bold py-1.5 px-4 rounded-lg transition duration-200 text-sm">
                            Resetear Filtros
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold">Tareas</h2>
                <div class="flex items-center gap-2">
                    <button id="btn-toggle-view" class="bg-slate-700 hover:bg-slate-600 text-white font-medium py-2 px-4 rounded-lg transition duration-200 flex items-center gap-2">
                        <svg id="icon-table" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden">
                            <path d="M3 3h18v18H3z"/>
                            <path d="M3 9h18"/>
                            <path d="M3 15h18"/>
                            <path d="M9 3v18"/>
                            <path d="M15 3v18"/>
                        </svg>
                        <svg id="icon-cards" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 3h18v18H3z"/>
                            <path d="M3 9h18"/>
                            <path d="M3 15h18"/>
                            <path d="M9 3v18"/>
                            <path d="M15 3v18"/>
                        </svg>
                        <span id="view-mode-text">Vista de Tarjetas</span>
                    </button>
                </div>
            </div>
            
            <!-- Vista de tarjetas -->
            <div id="tasks-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 overflow-y-auto flex-grow">
            </div>
            
            <!-- Vista de tabla -->
            <div id="tasks-table" class="hidden overflow-x-auto custom-scrollbar">
                <table class="min-w-full bg-slate-800 rounded-lg overflow-hidden">
                    <thead>
                        <tr class="bg-slate-700 text-left text-gray-200">
                            <th class="py-3 px-4 uppercase font-semibold text-sm">Título</th>
                            <th class="py-3 px-4 uppercase font-semibold text-sm">Creador</th>
                            <th class="py-3 px-4 uppercase font-semibold text-sm">Asignado a</th>
                            <th class="py-3 px-4 uppercase font-semibold text-sm">Prioridad</th>
                            <th class="py-3 px-4 uppercase font-semibold text-sm">Estado</th>
                            <th class="py-3 px-4 uppercase font-semibold text-sm">Privacidad</th>
                            <th class="py-3 px-4 uppercase font-semibold text-sm">Última Modificación</th>
                            <th class="py-3 px-4 uppercase font-semibold text-sm">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tasks-table-body" class="divide-y divide-slate-600">
                        <!-- Las tareas se cargarán aquí -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>
<div id="screen-user-management" class="hidden flex-1 flex flex-col">

        
        <header class="bg-slate-800 shadow-md p-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold">Configuración de Usuarios</h1>
            <div class="flex items-center gap-4">
                <span class="text-slate-300">Usuario: <span id="current-user-user-management" class="font-semibold text-indigo-400 cursor-pointer hover:text-indigo-300 transition-colors"></span></span>
                <div id="notifications-indicator-user-management" class="flex items-center gap-1 text-amber-400 hidden">
                    <div class="flex items-center justify-center w-4 h-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M6 8a6 6 0 0 1 12 0c0 7 3 8 3 8H3s3-1 3-8"/>
                            <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
                        </svg>
                    </div>
                    <span id="total-notifications-count-user-management" class="text-sm font-semibold">0</span>
                </div>
                
                <!-- Menú hamburguesa -->
                <div class="hamburger-menu">
                    <button id="hamburger-button-user-management" class="hamburger-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                    <div id="hamburger-dropdown-user-management" class="hamburger-dropdown">
                        <button id="btn-main-tasks-from-users" class="hamburger-item">
                            Tareas
                        </button>
                        <button id="btn-department-management-from-users" class="hamburger-item hidden">
                            Departamentos
                        </button>
                        <button id="btn-user-management-current" class="hamburger-item" disabled style="opacity: 0.5; cursor: not-allowed;">
                            Usuarios
                        </button>
                        <button id="btn-change-password-user-management" class="hamburger-item">
                            Cambiar Contraseña
                        </button>
                        <button id="btn-delete-own-account-user-management" class="hamburger-item" style="color: #fca5a5;">
                            Eliminar Mi Cuenta
                        </button>
                        <button id="btn-help-user-management" class="hamburger-item help-item">
                            Ayuda
                        </button>
                        <button id="btn-logout-user-management" class="hamburger-item">
                            Cerrar Sesión
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-1 p-8 flex flex-col">

        <div class="bg-slate-800 p-6 rounded-xl shadow-lg mb-6">
            <h2 class="text-xl font-semibold mb-4 text-emerald-300">Filtros de Usuarios</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label for="filter-user-name" class="block text-sm font-medium mb-1">Buscar por Nombre:</label>
                    <input type="text" id="filter-user-name" placeholder="Escribe el nombre del usuario"
                           class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
                <div>
                    <label for="filter-user-role" class="block text-sm font-medium mb-1">Filtrar por Rol:</label>
                    <select id="filter-user-role"
                            class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-500">
                        <option value="">Todos los Roles</option>
                        <option value="Usuario">Usuario</option>
                        <option value="Coordinador">Coordinador</option>
                        <option value="Responsable">Responsable</option>
                        <option value="Administrador">Administrador</option>
                    </select>
                </div>
                <div>
                    <label for="filter-user-department" class="block text-sm font-medium mb-1">Filtrar por Departamento:</label>
                    <select id="filter-user-department" class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-500">
                        <option value="">Todos los Departamentos</option>
                        <!-- Los departamentos se cargarán dinámicamente -->
                    </select>
                </div>
            </div>
            <div class="flex justify-between items-center">
                <button id="btn-clear-user-filters"
                        class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                    Limpiar Filtros
                </button>
                <button id="btn-show-new-user-modal-admin" 
                        class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg transition duration-200 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <line x1="19" y1="8" x2="19" y2="14"/>
                        <line x1="22" y1="11" x2="16" y2="11"/>
                    </svg>
                    Crear Nuevo Usuario
                </button>
            </div>
        </div>

        <div class="mt-8 bg-slate-800 p-6 rounded-xl shadow-lg">
            <h2 class="text-2xl font-semibold mb-4 text-emerald-300">Lista de Usuarios</h2>
            <div class="overflow-x-auto custom-scrollbar">
                <table class="min-w-full bg-slate-700 rounded-lg overflow-hidden">
                                         <thead>
                         <tr class="bg-slate-600 text-left text-gray-200">
                             <th class="py-3 px-4 uppercase font-semibold text-sm rounded-tl-lg">Nombre de Usuario</th>
                             <th class="py-3 px-4 uppercase font-semibold text-sm">Nombre Completo</th>
                             <th class="py-3 px-4 uppercase font-semibold text-sm">Rol</th>
                             <th class="py-3 px-4 uppercase font-semibold text-sm">Departamento</th>
                             <th class="py-3 px-4 uppercase font-semibold text-sm rounded-tr-lg">Acciones</th>
                         </tr>
                     </thead>
                    <tbody id="users-table-body" class="divide-y divide-slate-600">
                        </tbody>
                </table>
            </div>
        </div>
    </div>


    <div id="modal" class="fixed inset-0 hidden items-center justify-center modal-bg z-[1100]">
        <div class="w-full max-w-5xl mx-4 h-[90vh] bg-slate-900 rounded-2xl overflow-hidden flex relative">
            <!-- Botón de cerrar flotante en la esquina superior derecha -->
            <button id="close-modal" class="absolute top-4 right-4 z-10 w-8 h-8 flex items-center justify-center bg-slate-700 hover:bg-slate-600 rounded-full transition-colors" title="Cerrar">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            
            <div class="w-1/2 p-5 overflow-auto">
                <div class="flex justify-between items-start mb-3">
                    <h3 id="modal-title" class="text-lg font-semibold"></h3>
                    <div class="flex gap-2">
                        <span id="badge-ocupado" class="text-xs px-2 py-1 rounded-full bg-rose-600 hidden">Ocupado</span>
                    </div>
                </div>

                <label class="block text-sm mb-1">Título</label>
                <input id="edit-title" class="w-full mb-2 px-3 py-2 rounded-md bg-slate-800" />

                <label class="block text-sm mb-1">Descripción</label>
                <textarea id="edit-desc" rows="4" class="w-full mb-2 px-3 py-2 rounded-md bg-slate-800"></textarea>

                <div class="mb-3">
                    <label class="block text-sm mb-1">Asignado a</label>
                    <select id="edit-assigned-to" class="w-full px-3 py-2 rounded-md bg-slate-800">
                        <option value="Agustín">Agustín</option>
                        <option value="Héctor">Héctor</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-3 mb-3">
                    <div>
                        <label class="block text-sm mb-1">Prioridad</label>
                        <select id="edit-priority" class="w-full px-3 py-2 rounded-md bg-slate-800">
                            <option>Urgente</option>
                            <option>Alta</option>
                            <option>Media</option>
                            <option>Baja</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm mb-1">Estado</label>
                        <select id="edit-state" class="w-full px-3 py-2 rounded-md bg-slate-800">
                            <option>Sin iniciar</option>
                            <option>En progreso</option>
                            <option>En espera</option>
                            <option>Finalizada</option>
                        </select>
                    </div>
                    <div id="state-comment-box" class="mb-3 hidden col-span-2">
                        <label class="block text-sm mb-1">Comentario por cambio de estado (opcional)</label>
                        <input id="state-comment" class="w-full px-3 py-2 rounded-md bg-slate-800" placeholder="Explica por qué cambias el estado..." />
                    </div>
                </div>

                <div class="flex items-center gap-3 mb-4">
                    <button id="btn-save" class="px-4 py-2 rounded-xl bg-indigo-600">Guardar cambios</button>
                    <div class="flex items-center ml-auto">
                        <input type="checkbox" id="edit-private" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded mr-2" />
                        <label for="edit-private" class="text-sm">Mostrar esta tarea solo para mí</label>
                    </div>
                </div>
                <div id="edit-private-help" class="text-xs text-slate-400 mb-4 hidden">
                    <p>💡 <strong>Nota:</strong> Solo puedes hacer privada una tarea si eres el creador y está asignada a ti mismo.</p>
                </div>
                <p id="readonly-note" class="mt-3 text-sm text-rose-400 hidden">Esta tarea está ocupada por otro usuario y está en modo sólo lectura.</p>

            </div>

            <div class="w-1/2 border-l border-slate-800 flex flex-col">
                <div class="p-4 flex-1 overflow-auto" id="chat-box"></div>
                <div class="p-4 border-t border-slate-800">
                    <div class="mb-2 text-sm text-slate-400">Enviar mensaje como <span id="chat-user" class="font-medium"></span></div>
                    <!-- 🔄 NUEVO: Indicador de chat siempre habilitado -->
                    <div id="chat-status-indicator" class="mb-2 text-xs text-emerald-400 hidden">
                        💬 Chat siempre habilitado para comunicación
                    </div>
                    <div class="flex gap-2">
                        <input id="chat-input" class="flex-1 px-3 py-2 rounded-md bg-slate-800" placeholder="Escribe un mensaje..." />
                        <button id="chat-send" class="px-4 py-2 rounded-xl bg-emerald-600">Enviar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<div id="delete-confirm-modal" class="fixed inset-0 hidden items-center justify-center modal-bg z-[1100]">
    <div class="bg-slate-800 p-8 rounded-xl shadow-lg max-w-sm w-full text-center">
        <h3 id="delete-confirm-modal-title" class="text-xl font-semibold mb-4">Confirmar Eliminación</h3>
        <p id="delete-confirm-modal-message" class="mb-6">¿Estás seguro de que quieres eliminar esta tarea? Esta acción no se puede deshacer.</p>
        <div id="delete-confirm-modal-info" class="mb-4 p-3 bg-slate-700 rounded-lg text-sm text-slate-300 hidden">
            <p>💡 <strong>Información:</strong> Solo se pueden eliminar usuarios que estén en estado offline.</p>
        </div>
        
        <!-- Campo de confirmación de texto para auto-eliminación -->
        <div id="delete-confirm-text-input" class="mb-4 hidden">
            <label for="confirm-delete-text" class="block text-sm font-medium mb-2 text-rose-300">Para confirmar, escribe exactamente: <strong>ELIMINAR USUARIO</strong></label>
            <input type="text" id="confirm-delete-text" placeholder="ELIMINAR USUARIO"
                   class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-rose-500 text-center">
        </div>
        
        <div id="delete-confirm-modal-actions" class="flex justify-center gap-4">
            <button id="btn-delete-confirm" class="bg-rose-600 hover:bg-rose-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                Sí, Eliminar
            </button>
            <button id="btn-delete-cancel" class="bg-slate-600 hover:bg-slate-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                Cancelar
            </button>
        </div>
        <button id="btn-close-error-modal" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 hidden mt-4">
            Entendido
        </button>
    </div>
</div>

    <div id="edit-user-modal" class="fixed inset-0 hidden items-center justify-center modal-bg z-[1100]">
        <div class="bg-slate-800 rounded-xl shadow-lg max-w-6xl w-full h-[90vh] flex flex-col overflow-hidden">
            <!-- Header flotante (sticky) -->
            <div class="flex justify-between items-center p-6 bg-slate-800 border-b border-slate-700 flex-shrink-0">
                <h3 id="edit-user-modal-title" class="text-2xl font-semibold text-emerald-300">Editar Usuario</h3>
                <button id="btn-cancel-edit-user" class="px-3 py-1 rounded-md bg-slate-700 hover:bg-slate-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <!-- Contenido scrolleable -->
            <div class="flex-1 overflow-y-auto p-6">

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label for="edit-user-username" class="block text-sm font-medium mb-1">Nombre de Usuario:</label>
                    <input type="text" id="edit-user-username" readonly
                           class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none cursor-not-allowed">
                </div>

                <div>
                    <label for="edit-user-role" class="block text-sm font-medium mb-1">Tipo de Usuario:</label>
                    <select id="edit-user-role"
                            class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-500">
                        <option value="Usuario">Usuario</option>
                        <option value="Coordinador">Coordinador</option>
                        <option value="Responsable">Responsable</option>
                        <option value="Administrador">Administrador</option>
                    </select>
                    <div id="edit-user-role-help" class="text-xs text-slate-400 mt-1 hidden">
                        <p>⚠️ <strong>Nota:</strong> No se puede cambiar a usuario estándar si es el último administrador del sistema.</p>
                    </div>
                </div>

                <div>
                    <label for="edit-user-full-name" class="block text-sm font-medium mb-1">Nombre Completo:</label>
                    <input type="text" id="edit-user-full-name" placeholder="Nombre y apellidos"
                           class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-500">
                </div>

                <div>
                    <label for="edit-user-department" class="block text-sm font-medium mb-1">Departamento:</label>
                    <select id="edit-user-department"
                            class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-500">
                        <option value="">Sin departamento</option>
                        <!-- Los departamentos se cargarán dinámicamente -->
                    </select>
                </div>
            </div>

            <div class="mb-6">
                <label for="edit-user-password" class="block text-sm font-medium mb-1">Contraseña:</label>
                <input type="password" id="edit-user-password" placeholder="Dejar en blanco para no cambiar la contraseña"
                       class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-500">
            </div>

            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">Información Adicional:</label>
                <div class="bg-slate-700 p-4 rounded-lg">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs text-slate-400 mb-1">Fecha de Creación:</label>
                            <p id="edit-user-created-at" class="text-sm text-slate-200">-</p>
                        </div>
                        <div>
                            <label class="block text-xs text-slate-400 mb-1">Última Actividad:</label>
                            <p id="edit-user-last-activity" class="text-sm text-slate-200">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-end gap-4">
                <button id="btn-save-edited-user"
                        class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                    Guardar Cambios
                </button>
            </div>
            </div>
        </div>
    </div>


    <div id="change-password-modal" class="fixed inset-0 hidden items-center justify-center modal-bg z-[1100]">
        <div class="bg-slate-800 p-8 rounded-xl shadow-lg max-w-md w-full">
            <h3 class="text-2xl font-semibold mb-6 text-amber-300 text-center">Cambiar Contraseña</h3>
            
            <div class="mb-4">
                <label for="new-password" class="block text-sm font-medium mb-2">Nueva Contraseña:</label>
                <input type="password" id="new-password" placeholder="Introduce la nueva contraseña"
                       class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-amber-500">
                <p id="new-password-help" class="text-xs mt-1 text-slate-400">La contraseña debe tener al menos 3 caracteres</p>
            </div>
            
            <div class="mb-6">
                <label for="confirm-new-password" class="block text-sm font-medium mb-2">Confirmar Nueva Contraseña:</label>
                <input type="password" id="confirm-new-password" placeholder="Confirma la nueva contraseña"
                       class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-amber-500">
                <p id="confirm-password-help" class="text-xs mt-1 text-slate-400">Las contraseñas deben coincidir</p>
            </div>
            
            <div class="flex justify-end gap-4">
                <button id="btn-save-new-password"
                        class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                    Cambiar Contraseña
                </button>
                <button id="btn-cancel-change-password"
                        class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para crear nuevo usuario -->
    <div id="new-user-modal" class="fixed inset-0 hidden items-center justify-center modal-bg z-[1100]">
        <div class="bg-slate-800 p-8 rounded-xl shadow-lg max-w-md w-full">
            <h3 class="text-2xl font-semibold mb-6 text-indigo-300 text-center">Crear Nuevo Usuario</h3>
            
            <div class="mb-4">
                <label for="new-user-full-name" class="block text-sm font-medium mb-2">Nombre Completo:</label>
                <input type="text" id="new-user-full-name" placeholder="Nombre y apellido"
                       class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            </div>
            
            <div class="mb-4">
                <label for="new-user-username" class="block text-sm font-medium mb-2">Usuario de Acceso:</label>
                <input type="text" id="new-user-username" placeholder="Usuario (ej: jrodriguez)"
                       class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            </div>
            
            <div class="mb-4">
                <label for="new-user-password" class="block text-sm font-medium mb-2">Contraseña:</label>
                <input type="password" id="new-user-password" placeholder="Introduce la contraseña"
                       class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <p id="new-user-password-help" class="text-xs mt-1 text-slate-400">La contraseña debe tener al menos 6 caracteres</p>
            </div>
            
            <div class="mb-4">
                <label for="new-user-confirm-password" class="block text-sm font-medium mb-2">Confirmar Contraseña:</label>
                <input type="password" id="new-user-confirm-password" placeholder="Confirma la contraseña"
                       class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <p id="new-user-confirm-password-help" class="text-xs mt-1 text-slate-400">Las contraseñas deben coincidir</p>
            </div>
            
            
            <div class="mb-6">
                <label for="new-user-department" class="block text-sm font-medium mb-2">Departamento (Opcional):</label>
                <select id="new-user-department" class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="">Sin departamento</option>
                    <!-- Los departamentos se cargarán dinámicamente -->
                </select>
                <p class="text-xs mt-1 text-slate-400">Los usuarios sin departamento tienen limitaciones en visibilidad</p>
            </div>
            
            <div id="form-error-message" class="text-rose-400 text-sm mb-4 hidden">
                <!-- Los errores se mostrarán aquí -->
            </div>
            
            <div class="flex justify-end gap-4">
                <button id="btn-save-new-user"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 btn-disabled">
                    Crear Usuario
                </button>
                <button id="btn-cancel-new-user"
                        class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de éxito para usuario creado -->
    <div id="user-created-success-modal" class="fixed inset-0 hidden items-center justify-center modal-bg z-[1100]">
        <div class="bg-slate-800 p-8 rounded-xl shadow-lg max-w-md w-full text-center">
            <div class="mb-6">
                <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-emerald-100 mb-4">
                    <svg class="h-8 w-8 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-semibold text-emerald-300 mb-2">¡Usuario Creado!</h3>
                <p class="text-slate-300">El usuario ha sido creado correctamente.</p>
            </div>
            <button id="btn-close-success-modal"
                    class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-6 rounded-lg transition duration-200">
                Entendido
            </button>
        </div>
    </div>

    <!-- Modal de información del usuario -->
    <div id="user-info-modal" class="fixed inset-0 hidden items-center justify-center modal-bg z-[1100]">
        <div class="bg-slate-800 rounded-xl shadow-lg max-w-4xl w-full h-[90vh] flex flex-col overflow-hidden">
            <!-- Header flotante (sticky) -->
            <div class="flex justify-between items-center p-6 bg-slate-800 border-b border-slate-700 flex-shrink-0">
                <h3 class="text-2xl font-semibold text-indigo-300">Información de Visibilidad</h3>
                <button id="btn-close-user-info-modal" class="px-3 py-1 rounded-md bg-slate-700 hover:bg-slate-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <!-- Contenido scrolleable -->
            <div class="flex-1 overflow-y-auto p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                     <!-- Usuarios que tengo visibilidad -->
                     <div class="bg-slate-700 p-4 rounded-lg">
                         <h4 class="text-lg font-medium mb-3 text-emerald-300">Usuarios sobre los que tengo visibilidad</h4>
                         <div id="users-i-have-visibility" class="max-h-60 overflow-y-auto space-y-2 custom-scrollbar">
                             <!-- Los usuarios se cargarán aquí -->
                         </div>
                     </div>
                
                <!-- Usuarios que tienen visibilidad sobre mí -->
                <div class="bg-slate-700 p-4 rounded-lg">
                    <h4 class="text-lg font-medium mb-3 text-blue-300">Usuarios que tienen visibilidad sobre mí</h4>
                    <div id="users-who-have-visibility-over-me" class="max-h-60 overflow-y-auto space-y-2 custom-scrollbar">
                        <!-- Los usuarios se cargarán aquí -->
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalles de Tarea -->
    <div id="task-detail-modal" class="fixed inset-0 hidden items-center justify-center modal-bg z-[1100]">
        <div class="bg-slate-800 rounded-xl shadow-lg max-w-6xl w-full h-[95vh] flex overflow-hidden">
            
            <!-- Panel izquierdo - Detalles de la tarea -->
            <div class="w-1/2 flex flex-col border-r border-slate-700">
                <!-- Header -->
                <div class="flex justify-between items-center p-6 bg-slate-800 border-b border-slate-700 flex-shrink-0">
                    <h3 class="text-2xl font-semibold text-indigo-300">Detalles de Tarea</h3>
                    <button id="btn-close-task-detail-modal" class="px-3 py-1 rounded-md bg-slate-700 hover:bg-slate-600 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                
                <!-- Contenido de detalles -->
                <div class="flex-1 overflow-y-auto p-6 space-y-6">
                    <!-- Título -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Título</label>
                        <input type="text" id="task-detail-title" 
                               class="w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    
                    <!-- Descripción -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Descripción</label>
                        <textarea id="task-detail-description" rows="4"
                                  class="w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none"></textarea>
                    </div>
                    
                    <!-- Estado y Prioridad -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Estado</label>
                            <select id="task-detail-status" 
                                    class="w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="Sin iniciar">Sin iniciar</option>
                                <option value="En progreso">En progreso</option>
                                <option value="En espera">En espera</option>
                                <option value="Finalizada">Finalizada</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Prioridad</label>
                            <select id="task-detail-priority" 
                                    class="w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="Baja">Baja</option>
                                <option value="Media">Media</option>
                                <option value="Alta">Alta</option>
                                <option value="Urgente">Urgente</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Asignado a -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Asignado a</label>
                        <select id="task-detail-assigned" 
                                class="w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <!-- Se cargará dinámicamente -->
                        </select>
                    </div>
                    
                    <!-- Privada -->
                    <div class="flex items-center">
                        <input type="checkbox" id="task-detail-private" 
                               class="w-4 h-4 text-indigo-600 bg-slate-700 border-slate-600 rounded focus:ring-indigo-500">
                        <label for="task-detail-private" class="ml-2 text-sm text-slate-300">Tarea privada</label>
                    </div>
                    
                    <!-- Botones de acción -->
                    <div class="flex space-x-3 pt-4">
                        <button id="btn-save-task-changes" 
                                class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                            Guardar Cambios
                        </button>
                        <button id="btn-delete-task" 
                                class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                            Eliminar
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Panel derecho - Chat/Historial -->
            <div class="w-1/2 flex flex-col">
                <!-- Header del chat -->
                <div class="p-4 bg-slate-800 border-b border-slate-700 flex-shrink-0">
                    <h4 class="text-lg font-semibold text-emerald-300">Historial y Chat</h4>
                </div>
                
                <!-- Área de mensajes -->
                <div id="task-chat-messages" class="flex-1 overflow-y-auto p-4 space-y-3 bg-slate-900">
                    <!-- Los mensajes se cargarán aquí -->
                </div>
                
                <!-- Input de chat -->
                <div class="p-4 bg-slate-800 border-t border-slate-700 flex-shrink-0">
                    <div class="flex space-x-2">
                        <input type="text" id="chat-message-input" placeholder="Escribe un mensaje..." 
                               class="flex-1 px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-emerald-500">
                        <button id="btn-send-chat-message" 
                                class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg transition duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ayuda -->
    <div id="help-modal" class="fixed inset-0 hidden items-center justify-center modal-bg z-[1100]">
        <div class="bg-slate-800 rounded-xl shadow-lg max-w-4xl w-full h-[90vh] flex flex-col overflow-hidden">
            <!-- Header flotante (sticky) -->
            <div class="flex justify-between items-center p-6 bg-slate-800 border-b border-slate-700 flex-shrink-0">
                <h3 class="text-2xl font-semibold text-blue-300">Ayuda del Sistema</h3>
                <button id="btn-close-help-modal" class="px-3 py-1 rounded-md bg-slate-700 hover:bg-slate-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <!-- Contenido scrolleable -->
            <div id="help-content" class="flex-1 overflow-y-auto p-6">
                <!-- El contenido de ayuda se cargará dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Pantalla de Gestión de Departamentos -->
    <div id="screen-department-management" class="hidden min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-white">
        <!-- Header -->
        <div class="bg-slate-800 shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-6">
                    <h1 class="text-3xl font-bold text-emerald-300">Gestión de Departamentos</h1>
                    <div class="flex items-center space-x-4">
                        <span class="text-slate-300">Usuario: <span id="current-user-department-management" class="font-semibold text-indigo-400 cursor-pointer hover:text-indigo-300 transition-colors"></span></span>
                        <div id="notifications-indicator-department-management" class="flex items-center gap-1 text-amber-400 hidden">
                            <div class="flex items-center justify-center w-4 h-4">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M6 8a6 6 0 0 1 12 0c0 7 3 8 3 8H3s3-1 3-8"/>
                                    <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
                                </svg>
                            </div>
                            <span id="total-notifications-count-department-management" class="text-sm font-semibold">0</span>
                        </div>
                        
                        <!-- Menú hamburguesa -->
                        <div class="hamburger-menu">
                            <button id="hamburger-button-department-management" class="hamburger-button">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="3" y1="6" x2="21" y2="6"></line>
                                    <line x1="3" y1="12" x2="21" y2="12"></line>
                                    <line x1="3" y1="18" x2="21" y2="18"></line>
                                </svg>
                            </button>
                            <div id="hamburger-dropdown-department-management" class="hamburger-dropdown">
                                <button id="btn-main-tasks-from-departments" class="hamburger-item">
                                    Tareas
                                </button>
                                <button id="btn-department-management-current" class="hamburger-item" disabled style="opacity: 0.5; cursor: not-allowed;">
                                    Departamentos
                                </button>
                                <button id="btn-user-management-from-departments" class="hamburger-item hidden">
                                    Usuarios
                                </button>
                                <button id="btn-change-password-department-management" class="hamburger-item">
                                    Cambiar Contraseña
                                </button>
                                <button id="btn-delete-own-account-department-management" class="hamburger-item" style="color: #fca5a5;">
                                    Eliminar Mi Cuenta
                                </button>
                                <button id="btn-help-department-management" class="hamburger-item help-item">
                                    Ayuda
                                </button>
                                <button id="btn-logout-department-management" class="hamburger-item">
                                    Cerrar Sesión
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenido Principal -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Botón Nuevo Departamento -->
            <div class="mb-6">
                <button id="btn-new-department" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <span>Nuevo Departamento</span>
                </button>
            </div>

            <!-- Tabla de Departamentos -->
            <div class="bg-slate-800 rounded-lg shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-slate-700">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Nombre
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Descripción
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Usuarios
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Acciones
                                </th>
                            </tr>
                        </thead>
                        <tbody id="departments-table-body" class="bg-slate-800 divide-y divide-gray-700">
                            <!-- Las filas se generarán dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nuevo Departamento -->
    <div id="new-department-modal" class="fixed inset-0 hidden items-center justify-center modal-bg z-[1100]" style="display: none;">
        <div class="bg-slate-800 p-8 rounded-xl shadow-lg max-w-md w-full">
            <h3 class="text-2xl font-semibold mb-6 text-emerald-300 text-center">Nuevo Departamento</h3>
            
            <form id="new-department-form">
                <div class="mb-4">
                    <label for="new-department-name" class="block text-sm font-medium mb-2">Nombre del Departamento:</label>
                    <input type="text" id="new-department-name" required
                           class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
                
                <div class="mb-6">
                    <label for="new-department-description" class="block text-sm font-medium mb-2">Descripción:</label>
                    <textarea id="new-department-description" rows="3"
                              class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-500"></textarea>
                </div>
                
                <div class="flex justify-end gap-4">
                    <button type="button" data-modal-close="new-department-modal"
                            class="bg-slate-600 hover:bg-slate-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                        Cancelar
                    </button>
                    <button type="submit"
                            class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                        Crear Departamento
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Departamento -->
    <div id="edit-department-modal" class="fixed inset-0 hidden items-center justify-center modal-bg z-[1100]">
        <div class="bg-slate-800 rounded-xl shadow-lg max-w-4xl w-full h-[90vh] flex flex-col overflow-hidden">
            <!-- Header flotante (sticky) -->
            <div class="flex justify-between items-center p-6 bg-slate-800 border-b border-slate-700 flex-shrink-0">
                <h3 class="text-2xl font-semibold text-blue-300">Editar Departamento</h3>
                <button data-modal-close="edit-department-modal" class="px-3 py-1 rounded-md bg-slate-700 hover:bg-slate-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <!-- Contenido scrolleable -->
            <div class="flex-1 overflow-y-auto p-6">
                <form id="edit-department-form">
                    <input type="hidden" id="edit-department-id">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label for="edit-department-name" class="block text-sm font-medium mb-2">Nombre del Departamento:</label>
                            <input type="text" id="edit-department-name" required
                                   class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="edit-department-description" class="block text-sm font-medium mb-2">Descripción:</label>
                            <textarea id="edit-department-description" rows="3"
                                      class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                    </div>

                    <!-- Sección de usuarios del departamento -->
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-4 text-emerald-300">Usuarios del Departamento</h4>
                        <div id="department-users-list" class="space-y-3">
                            <!-- Los usuarios se cargarán dinámicamente -->
                        </div>
                    </div>
                    
                </form>
            </div>
        </div>
    </div>

<script type="module" src="src/index.js"></script>
</body>
</html>